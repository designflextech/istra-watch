<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- –û—Ç–∫–ª—é—á–∞–µ–º –∫—ç—à –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="no-cache, no-store, must-revalidate">
    <meta name="expires" content="0">
    <meta name="pragma" content="no-cache">
    
    <title>Istra Watch</title>
    <link rel="stylesheet" href="/static/css/style.css?v=20241020-6">
    <!-- Telegram Web App API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Optional: Telegram Apps SDK v3 -->
    <script src="https://cdn.jsdelivr.net/npm/@telegram-apps/sdk@3/dist/index.iife.js"></script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-screen" class="screen active">
        <div class="loader"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
    <div id="admin-screen" class="screen">
        <div class="admin-container">
            <div class="admin-content" style="position: relative;">
                <div class="screen-wrapper" style="padding-bottom: 0;">
                    <!-- Header -->
                    <div class="header sticky" style="padding-bottom: 16px;">
                        <h1 class="title-m" style="margin: 0;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h1>
                        <span id="admin-date" class="date-text"></span>
                    </div>
                    
                    <!-- Hidden date input for API calls -->
                    <input type="date" id="date-input" style="display: none;" />
                    
                    <!-- Employees List -->
                    <div id="employees-list" style="display: flex; flex-direction: column; gap: 6px; padding-bottom: 120px;"></div>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <nav class="bottom-nav">
                <div class="nav-tabbar">
                    <a class="nav-item" data-nav="map">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M20 8L12 14V26L20 20V8ZM20 8L28 4V16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M4 12L12 8V20L4 24V12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–ö–∞—Ä—Ç–∞</span>
                    </a>
                    <button class="nav-item active" data-nav="employees">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M21 28V26C21 24.9391 20.5786 23.9217 19.8284 23.1716C19.0783 22.4214 18.0609 22 17 22H9C7.93913 22 6.92172 22.4214 6.17157 23.1716C5.42143 23.9217 5 24.9391 5 26V28" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13 18C15.2091 18 17 16.2091 17 14C17 11.7909 15.2091 10 13 10C10.7909 10 9 11.7909 9 14C9 16.2091 10.7909 18 13 18Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M27 28V26C26.9993 25.1137 26.7044 24.2528 26.1614 23.5523C25.6184 22.8519 24.8581 22.3516 24 22.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20 10.13C20.8604 10.3503 21.623 10.8507 22.1676 11.5523C22.7122 12.2539 23.0078 13.1168 23.0078 14.005C23.0078 14.8932 22.7122 15.7561 22.1676 16.4577C21.623 17.1593 20.8604 17.6597 20 17.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
                    </button>
                    <a class="nav-item" data-nav="reports">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M18 28H8C7.46957 28 6.96086 27.7893 6.58579 27.4142C6.21071 27.0391 6 26.5304 6 26V6C6 5.46957 6.21071 4.96086 6.58579 4.58579C6.96086 4.21071 7.46957 4 8 4H20L26 10V26C26 26.5304 25.7893 27.0391 25.4142 27.4142C25.0391 27.7893 24.5304 28 24 28H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20 4V10H26" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–û—Ç—á–µ—Ç—ã</span>
                    </a>
                </div>
            </nav>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: –∑–∞–ø–∏—Å–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div id="employee-records-screen" class="screen">
        <div class="screen-wrapper">
            <!-- Navigation Bar -->
            <div class="employee-records-nav">
                <button id="employee-records-back-btn" class="icon-btn-back">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <span id="employee-records-date" class="date-text"></span>
            </div>
            
            <!-- Profile Card -->
            <div id="employee-records-container" class="employee-records-content"></div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –≥–ª–∞–≤–Ω–∞—è -->
    <div id="user-screen" class="screen">
        <div class="screen-wrapper">
            <!-- Header with Profile -->
            <div class="profile-header">
                <div class="profile-container">
                    <img id="user-avatar" class="profile-avatar" alt="Avatar">
                    <span id="user-name" class="profile-name"></span>
                </div>
                <div class="date-container">
                    <span id="user-date" class="date-text"></span>
                </div>
            </div>
            
            <!-- Time and Location Container -->
            <div id="time-location-container" class="time-location-container" style="display: none;">
                <!-- Arrival Record -->
                <div id="arrival-record" class="time-location-row" style="display: none;">
                    <div class="time-location-dot"></div>
                    <div class="time-location-details">
                        <div class="time-location-text">
                            <span id="arrival-time" class="time-text"></span>
                            <span class="separator-dot"></span>
                            <span id="arrival-location" class="location-text"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Divider (only shown when both records exist) -->
                <div id="time-location-divider" class="time-location-divider" style="display: none;"></div>
                
                <!-- Departure Record -->
                <div id="departure-record" class="time-location-row" style="display: none;">
                    <div class="time-location-dot"></div>
                    <div class="time-location-details">
                        <div class="time-location-text">
                            <span id="departure-time" class="time-text"></span>
                            <span class="separator-dot"></span>
                            <span id="departure-location" class="location-text"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –Ø–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–∞ -->
            <div style="padding: 0 16px; margin-top: 20px;">
                <div id="user-map" class="user-map no-records"></div>
            </div>
            
            <!-- Action Button -->
            <div id="action-button-container" class="action-button-container no-records" style="display: flex; justify-content: center; padding: 0 16px;">
                <button id="action-btn" class="btn btn-primary" style="display: none; width: 195px;">
                    <!-- –¢–µ–∫—Å—Ç –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </button>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ -->
    <div id="record-screen" class="screen">
        <div class="screen-wrapper" style="background: var(--bg-main);">
            <!-- Profile Header -->
            <div class="profile-header" style="margin-top: var(--space-24);">
                <div class="profile-container">
                    <img id="record-avatar" class="profile-avatar" alt="Avatar">
                    <span id="record-user-name" class="profile-name"></span>
                </div>
                <div class="date-container">
                    <span id="record-date" class="date-text"></span>
                </div>
            </div>
            
            <!-- Main Form -->
            <form id="record-form" style="padding: 0 var(--page-padding-x); margin-top: 32px; display: flex; flex-direction: column; gap: 32px;">
                <!-- Address Container -->
                <div class="input-container" style="gap: 4px;">
                    <!-- Green Address Block -->
                    <div class="address-info" id="address-info">
                        <svg class="address-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="currentColor"/>
                        </svg>
                        <span class="address-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥—Ä–µ—Å–∞...</span>
                    </div>
                    
                    <!-- DateTime Block -->
                    <div class="datetime-container">
                        <div class="datetime-item">
                            <span class="datetime-label">–î–∞—Ç–∞</span>
                            <span class="datetime-value" id="record-date-value">--</span>
                        </div>
                        <div class="datetime-divider"></div>
                        <div class="datetime-item">
                            <span class="datetime-label">–í—Ä–µ–º—è</span>
                            <span class="datetime-value" id="record-time-value">--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Comment Section -->
                <div class="input-container">
                    <label class="input-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                    <textarea id="comment" class="input-field" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
                </div>
                
                <!-- Photo Section -->
                <div class="photo-section">
                    <label class="input-label">
                        –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é<span style="color: #ec1919;">*</span>
                    </label>
                    <div class="photo-container">
                        <div class="photo-item" id="add-photo-btn">
                            <svg class="photo-add-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                                <path d="M16 8V24M8 16H24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <div class="photo-item" id="photo-loading" style="display: none;">
                            <div class="loader small photo-loading-icon"></div>
                        </div>
                        <div class="photo-item" id="photo-preview" style="display: none;">
                            <img id="preview-image" alt="Preview" style="display: none;">
                            <button type="button" id="remove-photo-btn" class="photo-delete-btn">
                                <svg class="photo-delete-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <input type="file" id="photo-input" accept="image/*" style="display: none;">
                </div>
                
                <!-- Buttons Container -->
                <div style="display: flex; gap: 4px; padding-bottom: 16px;">
                    <button type="button" id="cancel-btn" class="btn btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary submit-btn" style="width: 195px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
            
            <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–∞–º–µ—Ä—ã -->
            <div id="camera-modal" class="camera-modal" style="display: none;">
                <div class="camera-container">
                    <div class="camera-header">
                        <h3>–ö–∞–º–µ—Ä–∞</h3>
                        <button type="button" id="close-camera-btn" class="close-camera-btn">√ó</button>
                    </div>
                    <video id="camera-video" class="camera-video" autoplay playsinline></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                    <div class="camera-controls">
                        <button type="button" id="switch-camera-btn" class="switch-camera-btn">üîÑ</button>
                        <button type="button" id="capture-btn" class="capture-btn"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π –∑–∞–ø–∏—Å–∏ -->
    <div id="details-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-container">
                    <p id="details-type" class="modal-subtitle"></p>
                    <h2 id="details-user-name" class="modal-title"></h2>
                </div>
                <button id="details-close-btn" class="modal-close-btn">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <path d="M24 8L8 24M8 8L24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div id="record-details" class="modal-body"></div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∫–∞—Ä—Ç—ã —Å–æ –≤—Å–µ–º–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è–º–∏ -->
    <div id="map-screen" class="screen">
        <div class="admin-container">
            <div class="admin-content" style="height: 100vh; overflow: hidden; position: relative;">
                <!-- Map Container -->
                <div id="full-map" style="width: 100%; height: 100vh; position: relative; background: #f4f4f5;"></div>
            </div>
            
            <!-- Bottom Navigation -->
            <nav class="bottom-nav">
                <div class="nav-tabbar">
                    <button class="nav-item active" data-nav="map">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M20 8L12 14V26L20 20V8ZM20 8L28 4V16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M4 12L12 8V20L4 24V12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–ö–∞—Ä—Ç–∞</span>
                    </button>
                    <a class="nav-item" data-nav="employees">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M21 28V26C21 24.9391 20.5786 23.9217 19.8284 23.1716C19.0783 22.4214 18.0609 22 17 22H9C7.93913 22 6.92172 22.4214 6.17157 23.1716C5.42143 23.9217 5 24.9391 5 26V28" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13 18C15.2091 18 17 16.2091 17 14C17 11.7909 15.2091 10 13 10C10.7909 10 9 11.7909 9 14C9 16.2091 10.7909 18 13 18Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M27 28V26C26.9993 25.1137 26.7044 24.2528 26.1614 23.5523C25.6184 22.8519 24.8581 22.3516 24 22.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20 10.13C20.8604 10.3503 21.623 10.8507 22.1676 11.5523C22.7122 12.2539 23.0078 13.1168 23.0078 14.005C23.0078 14.8932 22.7122 15.7561 22.1676 16.4577C21.623 17.1593 20.8604 17.6597 20 17.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
                    </a>
                    <a class="nav-item" data-nav="reports">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M18 28H8C7.46957 28 6.96086 27.7893 6.58579 27.4142C6.21071 27.0391 6 26.5304 6 26V6C6 5.46957 6.21071 4.96086 6.58579 4.58579C6.96086 4.21071 7.46957 4 8 4H20L26 10V26C26 26.5304 25.7893 27.0391 25.4142 27.4142C25.0391 27.7893 24.5304 28 24 28H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20 4V10H26" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–û—Ç—á–µ—Ç—ã</span>
                    </a>
                </div>
            </nav>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ—Ç—á–µ—Ç–æ–≤ -->
    <div id="reports-screen" class="screen">
        <div class="admin-container">
            <div class="admin-content" style="position: relative;">
                <div class="screen-wrapper" style="padding-bottom: 0;">
                    <!-- Header -->
                    <div class="header sticky" style="padding-bottom: 16px;">
                        <h1 class="title-m" style="margin: 0;">–û—Ç—á–µ—Ç—ã</h1>
                        <span id="reports-date" class="date-text"></span>
                    </div>
                    
                    <!-- Reports Container -->
                    <div id="reports-container" class="reports-list" style="padding-bottom: 120px;"></div>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <nav class="bottom-nav">
                <div class="nav-tabbar">
                    <a class="nav-item" data-nav="map">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M20 8L12 14V26L20 20V8ZM20 8L28 4V16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M4 12L12 8V20L4 24V12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–ö–∞—Ä—Ç–∞</span>
                    </a>
                    <a class="nav-item" data-nav="employees">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M21 28V26C21 24.9391 20.5786 23.9217 19.8284 23.1716C19.0783 22.4214 18.0609 22 17 22H9C7.93913 22 6.92172 22.4214 6.17157 23.1716C5.42143 23.9217 5 24.9391 5 26V28" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M13 18C15.2091 18 17 16.2091 17 14C17 11.7909 15.2091 10 13 10C10.7909 10 9 11.7909 9 14C9 16.2091 10.7909 18 13 18Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M27 28V26C26.9993 25.1137 26.7044 24.2528 26.1614 23.5523C25.6184 22.8519 24.8581 22.3516 24 22.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20 10.13C20.8604 10.3503 21.623 10.8507 22.1676 11.5523C22.7122 12.2539 23.0078 13.1168 23.0078 14.005C23.0078 14.8932 22.7122 15.7561 22.1676 16.4577C21.623 17.1593 20.8604 17.6597 20 17.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</span>
                    </a>
                    <button class="nav-item active" data-nav="reports">
                        <svg class="nav-icon" width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <path d="M18 28H8C7.46957 28 6.96086 27.7893 6.58579 27.4142C6.21071 27.0391 6 26.5304 6 26V6C6 5.46957 6.21071 4.96086 6.58579 4.58579C6.96086 4.21071 7.46957 4 8 4H20L26 10V26C26 26.5304 25.7893 27.0391 25.4142 27.4142C25.0391 27.7893 24.5304 28 24 28H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M20 4V10H26" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="nav-label">–û—Ç—á–µ—Ç—ã</span>
                    </button>
                </div>
            </nav>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ Debug Box (—Å–∫—Ä—ã—Ç–∞) -->
    <button id="debug-show-btn" style="
        position: fixed;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 50, 0, 0.8);
        color: #00ff00;
        border: 2px solid #00ff00;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 20px;
        z-index: 99998;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
    ">üêõ</button>

    <!-- Debug Box –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="debug-box" style="
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.95);
        border-top: 2px solid #00ff00;
        color: #00ff00;
        font-family: monospace;
        font-size: 11px;
        z-index: 99999;
        max-height: 40vh;
        display: none;
        flex-direction: column;
    ">
        <div style="
            padding: 8px;
            background: rgba(0, 50, 0, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #00ff00;
        ">
            <strong>üêõ DEBUG LOG</strong>
            <div>
                <button id="debug-clear-btn" style="
                    background: #004400;
                    color: #00ff00;
                    border: 1px solid #00ff00;
                    padding: 4px 8px;
                    margin-right: 4px;
                    border-radius: 3px;
                    font-size: 10px;
                ">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <button id="debug-toggle-btn" style="
                    background: #004400;
                    color: #00ff00;
                    border: 1px solid #00ff00;
                    padding: 4px 8px;
                    border-radius: 3px;
                    font-size: 10px;
                ">–°–≤–µ—Ä–Ω—É—Ç—å/–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</button>
            </div>
        </div>
        <div id="debug-content" style="
            padding: 8px;
            overflow-y: auto;
            flex: 1;
            max-height: calc(40vh - 45px);
        ">
            <div style="color: #ffff00; font-weight: bold;">–û–∂–∏–¥–∞–Ω–∏–µ –ª–æ–≥–æ–≤...</div>
        </div>
    </div>

    <!-- –†–∞–Ω–Ω—è—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <script>
        // –†–∞–Ω–Ω–∏–π –ª–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;
        
        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä–∞–Ω–Ω–∏—Ö –ª–æ–≥–æ–≤
        window.earlyLogs = [];
        window.earlyDebugLog = function(msg, data) {
            const log = {
                timestamp: new Date().toLocaleTimeString(),
                message: msg,
                data: data
            };
            window.earlyLogs.push(log);
            originalConsoleLog('[EARLY DEBUG]', msg, data);
            
            // –ü—Ä–æ–±—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å –≤ debug box –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å
            const debugContent = document.getElementById('debug-content');
            if (debugContent) {
                const dataStr = data ? '<pre style="font-size: 9px; max-height: 150px; overflow: auto; white-space: pre-wrap;">' + JSON.stringify(data, null, 2).substring(0, 800) + '</pre>' : '';
                debugContent.innerHTML += `<div style="border-bottom: 1px solid #333; padding: 4px 0; font-size: 10px;">
                    <strong style="color: #0f0;">[${log.timestamp}]</strong> ${msg}
                    ${dataStr}
                </div>`;
                debugContent.scrollTop = debugContent.scrollHeight;
            }
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Debug Box
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ Telegram
            const firstArg = String(args[0]);
            if (firstArg.includes('[Telegram.WebView]') || 
                firstArg.includes('viewport_changed') ||
                firstArg.includes('safe_area_changed')) {
                return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏
            }
            
            const msg = args.map(arg => {
                if (typeof arg === 'object') {
                    try { 
                        const str = JSON.stringify(arg, null, 2);
                        // –û–±—Ä–µ–∑–∞–µ–º –¢–û–õ–¨–ö–û –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã (–±–æ–ª—å—à–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤)
                        return str.length > 1000 ? str.substring(0, 1000) + '...[truncated]' : str;
                    } 
                    catch(e) { return String(arg); }
                }
                return String(arg);
            }).join(' ');
            window.earlyDebugLog('üìù ' + msg);
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            const msg = args.join(' ');
            window.earlyDebugLog('‚ùå Error: ' + msg);
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            const msg = args.join(' ');
            window.earlyDebugLog('‚ö†Ô∏è Warning: ' + msg);
        };
        
        const APP_VERSION = '20241020-v3-records-spacing'; // –í–µ—Ä—Å–∏—è —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ –∑–∞–ø–∏—Å–µ–π
        console.log('üîß Early init: DOM loaded, starting debug');
        console.log('üì¶ App version:', APP_VERSION);
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ CSS –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫–µ—à–∞
        const timestamp = Date.now();
        const styleLink = document.querySelector('link[href*="style.css"]');
        if (styleLink) {
            const originalHref = styleLink.href.split('?')[0];
            styleLink.href = originalHref + '?v=' + timestamp + '&force=' + Math.random();
            console.log('üîÑ CSS cache busted:', styleLink.href);
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–µ—Ä—Å–∏—é WebView –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É ES6
        const ua = navigator.userAgent;
        const chromeMatch = ua.match(/Chrome\/(\d+)/);
        const chromeVersion = chromeMatch ? parseInt(chromeMatch[1]) : null;
        const supportsES6Modules = chromeVersion >= 61; // Chrome 61+ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ES6 –º–æ–¥—É–ª–∏
        
        window.earlyDebugLog('üì± Platform Info v' + APP_VERSION, {
            appVersion: APP_VERSION,
            userAgent: ua,
            isMobile: /Mobile|Android|iPhone/i.test(ua),
            hasTelegram: !!window.Telegram,
            hasWebApp: !!window.Telegram?.WebApp,
            chromeVersion: chromeVersion,
            supportsES6Modules: supportsES6Modules,
            telegramVersion: window.Telegram?.WebApp?.version || 'unknown'
        });
    </script>

    <script type="module" src="/static/js/app.js?v=20241020-2"></script>
</body>
</html>

